var phoneList = {
  01: {
    type: "Samsung",
    name: "Samsung Galaxy Z Flip4 5G Flex Mode Collection",
    cost_before: 25990000,
    cost_after: 20990000,
    cpu: "Snapdragon 8+ Gen 1",
    screen: "6.7 inch",
    ram: "8 GB",
    memory: "256 GB",
    image:
      "assets/img/namephone/Samsung/samsung-galaxy-z-flip4-flex-mode-dd-docquyen-bh.webp",
  },
  02: {
    type: "Samsung",
    name: "Samsung Galaxy S22 5G 128GB",
    cost_before: 21990000,
    cost_after: 15990000,
    cpu: "Snapdragon 8 Gen 1",
    screen: "6.1 inch",
    ram: "8 GB",
    memory: "128 GB",
    image: "assets/img/namephone/Samsung/samsung-galaxy-s22.webp",
  },
  03: {
    type: "Samsung",
    name: "Samsung Galaxy S22 Ultra 5G 128GB",
    cost_before: 30990000,
    cost_after: 23990000,
    cpu: "Snapdragon 8 Gen 1",
    screen: "6.8 inch",
    ram: "8 GB",
    memory: "128 GB",
    image: "assets/img/namephone/Samsung/samsung-galaxy-s22-ultra.webp",
  },
  04: {
    type: "Samsung",
    name: "Samsung Galaxy S22 Bora Purple",
    cost_before: 21990000,
    cost_after: 12990000,
    cpu: "Snapdragon 8 Gen 1",
    screen: "6.1 inch",
    ram: "8 GB",
    memory: "128 GB",
    image: "assets/img/namephone/Samsung/samsung-galaxy-s22-bora-purple.webp",
  },
  05: {
    type: "Oppo",
    name: "OPPO Find X5 Pro 12GB - 256GB",
    cost_before: 32990000,
    cost_after: 26990000,
    cpu: "Snapdragon 8 Gen 1",
    screen: "6.7 inch",
    ram: "12 GB",
    memory: "256 GB",
    image: "assets/img/namephone/Oppo/oppo-find-x5-pro-dd.webp",
  },
  06: {
    type: "Oppo",
    name: "OPPO A16k 3GB-32GB",
    cost_before: 3290000,
    cost_after: 2890000,
    cpu: "Helio G35",
    screen: "6.52 inch",
    ram: "3 GB",
    memory: "32 GB",
    image: "assets/img/namephone/Oppo/oppo-a16k-dd.webp",
  },
  07: {
    type: "Oppo",
    name: "OPPO Reno8 Pro 5G 12GB - 256GB",
    cost_before: 18990000,
    cost_after: 18490000,
    cpu: "MediaTek Dimensity 8100 Max 5G",
    screen: "6.7 inch",
    ram: "12 GB",
    memory: "256 GB",
    image: "assets/img/namephone/Oppo/oppo-reno8-pro-dd.webp",
  },
  08: {
    type: "Oppo",
    name: "OPPO A96 8GB-128GB",
    cost_before: 6990000,
    cost_after: 6290000,
    cpu: "Snapdragon 680",
    screen: "6.59 inch",
    ram: "8 GB",
    memory: "128 GB",
    image: "assets/img/namephone/Oppo/oppo-a96-8gb-128gb-dd.webp",
  },
  09: {
    type: "Iphone",
    name: "iphone 14 Pro Max 128GB",
    cost_before: 34990000,
    cost_after: 33490000,
    cpu: "Apple A16 Bionic",
    screen: "6.7 inch",
    memory: "128 GB",
    image: "assets/img/namephone/Iphone/iphone-14-pro-max.webp",
  },
  10: {
    type: "Iphone",
    name: "iphone 13 Pro Max 128GB",
    cost_before: 33990000,
    cost_after: 27490000,
    cpu: "Apple A15 Bionic",
    screen: "6.7 inch",
    ram: "6 GB",
    memory: "128 GB",
    image: "assets/img/namephone/Iphone/iphone-13-pro-dd-bh.webp",
  },
  11: {
    type: "Vivo",
    name: "Vivo Y15s 3GB - 32GB",
    cost_before: 3490000,
    cost_after: 3090000,
    cpu: "Helio P35",
    screen: "6.51 inch",
    ram: "3 GB",
    memory: "32 GB",
    image:
      "assets/img/namephone/Vivo/637707822857432352_00779950-vivo-y15s-trang-xanh-dd.webp",
  },
  12: {
    type: "Vivo",
    name: "Vivo T1x 4GB-64GB",
    cost_before: 4490000,
    cost_after: 4190000,
    cpu: "snapdragon 680",
    screen: "6.58 inch",
    ram: "4 GB",
    memory: "64 GB",
    image: "assets/img/namephone/Vivo/vivo-t1x-xanh-dd.webp",
  },
  13: {
    type: "Vivo",
    name: "Vivo Y35 8GB-128GB",
    cost_before: 6690000,
    cost_after: 6590000,
    cpu: "snapdragon 680",
    screen: "6.58 inch",
    ram: "8 GB",
    memory: "128 GB",
    image: "assets/img/namephone/Vivo/638016881305619480_vivo-y35-den-dd.webp",
  },
  14: {
    type: "Vivo",
    name: "Vivo Y22s 8GB-128GB",
    cost_before: 5990000,
    cost_after: 5590000,
    cpu: "snapdragon 680",
    screen: "6.55 inch",
    ram: "8 GB",
    memory: "128 GB",
    image:
      "assets/img/namephone/Vivo/637983398315589960_vivo-y22s-xanh-dd.webp",
  },
  15: {
    type: "Nokia",
    name: "Nokia C30 3GB-32GB",
    cost_before: 2990000,
    cost_after: 2690000,
    cpu: "Spreadtrum SC9863A",
    screen: "6.82 inch",
    ram: "3 GB",
    memory: "32 GB",
    image: "assets/img/namephone/Nokia/nokia-c30-xanh-dd.webp",
  },
  16: {
    type: "Nokia",
    name: "Nokia G21 6GB-128GB	",
    cost_before: 4590000,
    cost_after: 3790000,
    cpu: "Unisoc T606",
    screen: "6.5 inch",
    ram: "6 GB",
    memory: "128 GB",
    image: "assets/img/namephone/Nokia/nokia-g21-dd-docquyen.webp",
  },
  17: {
    type: "Nokia",
    name: "Nokia G11 Plus 3GB-32GB",
    cost_before: "3.390.000",
    cost_after: "2.790.000",
    cpu: "Unisoc T606",
    screen: "6.52 inch",
    ram: "3 GB",
    memory: "32 GB",
    image: "assets/img/namephone/Nokia/nokia-g11-plus-dd.webp",
  },
  18: {
    type: "Xiaomi",
    name: "Xiaomi Redmi A1 2GB-32GB",
    cost_before: 2190000,
    cost_after: 2090000,
    cpu: "Helio A22",
    screen: "6.52 inch",
    ram: "2 GB",
    memory: "32 GB",
    image: "assets/img/namephone/Xiaomi/xiaomi-redmi-a1-den-dd-bh.webp",
  },
  19: {
    type: "Xiaomi",
    name: "Xiaomi Redmi 9A 2GB-32GB",
    cost_before: 2490000,
    cost_after: 2090000,
    cpu: "Helio G25",
    screen: "6.53 inch",
    ram: "2 GB",
    memory: "32 GB",
    image: "assets/img/namephone/Xiaomi/xiaomi-redmi-9a.webp",
  },
  20: {
    type: "Xiaomi",
    name: "Xiaomi 12T 8GB-128GB",
    cost_before: 12490000,
    cost_after: 11990000,
    cpu: "MediaTek Dimensity 8100 Ultra",
    screen: "6.67 inch",
    ram: "8 GB",
    memory: "128 GB",
    image: "assets/img/namephone/Xiaomi/xiaomi-12t-den.webp",
  },
};
const toast = ({ title = "", msg = "", type, duration = 3000 }) => {
  const main = document.querySelector(".container.toasts");
  console.log(main);
  if (main) {
    const myToast = document.createElement("div");
    const icons = {
      success: "fas fa-check-circle",
      error: "fas fa-exclamation-circle",
    };

    const icon = icons[type];
    myToast.classList.add("toast1", `toast--${type}`);
    myToast.innerHTML = `
      <div class="toast__icon">
        <i class="${icon}"></i>
      </div>
      <div class="toast__body">
        <h4 class="toast__title">${title}</h4>
        <p class="toast__msg">${msg}</p>
    </div>`;
    main.append(myToast);

    setTimeout(() => {
      main.removeChild(myToast);
    }, duration + 1000);
  }
};

function addCart(code) {
  if (typeof localStorage[code] == "undefined") {
    window.localStorage.setItem(code, 1);
    current2 = parseInt(window.localStorage.getItem("cartNumbers"));
    window.localStorage.setItem("cartNumbers", current2 + 1);
  } else {
    current = parseInt(window.localStorage.getItem(code));
    current2 = parseInt(window.localStorage.getItem("cartNumbers"));
    window.localStorage.setItem(code, current + 1);
    window.localStorage.setItem("cartNumbers", current2 + 1);
  }
  cartNumbers();
}

let carts = document.querySelectorAll(".add-cart");

for (let i = 0; i < carts.length; i++) {
  carts[i].addEventListener("click", () => {
    cartNumbers(phoneList[i]);
  });
}
window.onload = function showCart() {
  var sum = 0;
  for (var i = 0; i < localStorage.length; i++) {
    var keyName = window.localStorage.key(i);
    if (
      keyName == "01" ||
      keyName == "02" ||
      keyName == "03" ||
      keyName == "04" ||
      keyName == "05" ||
      keyName == "06" ||
      keyName == "07" ||
      keyName == "08" ||
      keyName == "09" ||
      keyName == "10" ||
      keyName == "11" ||
      keyName == "12" ||
      keyName == "13" ||
      keyName == "14" ||
      keyName == "15" ||
      keyName == "16" ||
      keyName == "17" ||
      keyName == "18" ||
      keyName == "19" ||
      keyName == "20"
    ) {
      var current = parseInt(window.localStorage.getItem(keyName));
      keyName = parseInt(keyName);
      var table = document.getElementById("tb");
      var row = table.insertRow(1);
      var price = parseInt(phoneList[keyName].cost_after);
      var price2 = parseInt(phoneList[keyName].cost_before);
      sum = price * current + sum;
      var temp = sum - 0.1 * sum;
      var vat = 0.1 * temp;
      var total = temp + vat;

      const formatter = new Intl.NumberFormat("vi-VN", {
        style: "currency",
        currency: "VND",
      });
      document.getElementById("s").innerHTML = formatter.format(sum);
      document.getElementById("vat").innerHTML = formatter.format(vat);
      document.getElementById("total").innerHTML = formatter.format(total);

      if (keyName < 10) {
        keyName = "0" + keyName;
      }

      row.innerHTML = `
                    <td class="buy-product">
                        <div class="img-container">
                            <img src="${
                              phoneList[parseInt(keyName)].image
                            }" alt="" class="img">
                        </div>
                        <p class="name-phone">${
                          phoneList[parseInt(keyName)].name
                        }</p>
                    </td>
                    <td class="text-center" style="padding-top:25px;">
                        <span>${formatter.format(
                          phoneList[parseInt(keyName)].cost_after
                        )}</span>
                        <div class="discount"><i>${formatter.format(
                          phoneList[parseInt(keyName)].cost_before
                        )}</i></div>
                    </td>
                    <td class="cart-number text-center">
                        <button style="padding-right:8px;" onclick="minusCart('${keyName}'); loadcartNumbersminus(); cartNumbersminus(phoneList); window.location.reload()" class="btn-cart">
                            <i class="fa-solid fa-circle-minus" style="color:rgb(54, 160, 231)"></i>
                        </button>
                        <span>${current}</span>
                        <button style="padding-left:8px;" onclick="addCart('${keyName}'); loadcartNumbers(); cartNumbers(phoneList); window.location.reload()" class="btn-cart">
                            <i class="fa-solid fa-circle-plus" style="color:rgb(54, 160, 231)"></i>
                        </button>
                    </td>
                    <td class="text-center" style="padding-top:25px;">
                        <span>${formatter.format(current * price)}</span>
                        <div class="discount"><i>${formatter.format(
                          current * price2
                        )}</i></div>
                    </td>
                    <td class="text-center">
                        <button onclick="removeCart('${keyName}')" class="btn-cart">
                            <i class="fa-solid fa-trash" style="color:rgb(54, 160, 231)"></i>
                        </button>
                    </td>
                    `;
      table.append(row);
    }
  }
  var imgs = document.querySelectorAll(".img");
  var names = data.querySelectorAll(".name-phone");
  var buyProduct = [];
  for (var i = 0; i < names.length; i++) {
    buyProduct.push({ img: imgs[i].src, name: names[i].textContent });
  }
  localStorage.setItem("buyProducts", JSON.stringify(buyProduct));
};

function loadcartNumbers() {
  let productNumbers = localStorage.getItem("cartNumbers");

  if (productNumbers) {
    document.querySelector(".cart-number span").textContent = productNumbers;
  }
}

function cartNumbers(phoneList) {
  let productNumbers = localStorage.getItem("cartNumbers");

  productNumbers = parseInt(productNumbers);

  if (productNumbers) {
    localStorage.setItem("cartNumbers", productNumbers);
    document.querySelector(".cart-number span").textContent = productNumbers;
  } else {
    localStorage.setItem("cartNumbers", 1);
    document.querySelector(".cart-number span").textContent = 1;
  }
}

//minus

function minusCart(code) {
  if (parseInt(window.localStorage.getItem(code)) != "0") {
    current = parseInt(window.localStorage.getItem(code));
    console.log(current);
    window.localStorage.setItem(code, current - 1);
  }
  if (parseInt(window.localStorage.getItem(code)) == "0") {
    removeCart(code);
  }
}

function cartNumbersminus(phoneList) {
  let productNumbers = localStorage.getItem("cartNumbers");

  productNumbers = parseInt(productNumbers);

  if (productNumbers) {
    localStorage.setItem("cartNumbers", productNumbers - 1);
    document.querySelector(".cart-number span").textContent =
      productNumbers - 1;
  } else {
    localStorage.setItem("cartNumbers", 1);
    document.querySelector(".cart-number span").textContent = 1;
  }
}

function loadcartNumbersminus() {
  let productNumbers = localStorage.getItem("cartNumbersminus");

  if (productNumbers) {
    document.querySelector(".cart-number span").textContent = productNumbers;
  }
}

//remove

function removeCart(code) {
  if (typeof window.localStorage[code] !== "undefined") {
    let productNumbers = localStorage.getItem("cartNumbers");
    productNumbers = parseInt(productNumbers);
    localStorage.setItem(
      "cartNumbers",
      productNumbers - parseInt(window.localStorage.getItem(code))
    );
    document.querySelector(".cart-number span").textContent =
      productNumbers - parseInt(window.localStorage.getItem(code));

    loadcartNumbersremove();
    window.localStorage.removeItem(code);
    location.reload();
  }
}

function loadcartNumbersremove() {
  let productNumbers = localStorage.getItem("cartNumbers");

  if (productNumbers) {
    document.querySelector(".cart-number span").textContent = productNumbers;
  }
}

function removeAll() {
  localStorage.removeItem("01");
  localStorage.removeItem("02");
  localStorage.removeItem("03");
  localStorage.removeItem("04");
  localStorage.removeItem("05");
  localStorage.removeItem("06");
  localStorage.removeItem("06");
  localStorage.removeItem("07");
  localStorage.removeItem("08");
  localStorage.removeItem("09");
  localStorage.removeItem("10");
  localStorage.removeItem("11");
  localStorage.removeItem("12");
  localStorage.removeItem("13");
  localStorage.removeItem("14");
  localStorage.removeItem("15");
  localStorage.removeItem("16");
  localStorage.removeItem("17");
  localStorage.removeItem("18");
  localStorage.removeItem("19");
  localStorage.removeItem("20");
  localStorage.removeItem("cartNumbers");
}

//

const validateName = (name) => {
  if (name.length > 4) {
    return true;
  }
  return false;
};

const validateMail = (mail) => {
  const reg = /^[a-z][a-z0-9_\.]{5,32}@[a-z0-9]{2,}(\.[a-z0-9]{2,4}){1,2}/;
  if (reg.test(mail) == true) {
    return true;
  }
  return false;
};

const validatePhone = (phone) => {
  if (phone.length == 10) {
    return true;
  }
  return false;
};

function valid() {
  var userName = document.getElementById("user-name");
  var userPhone = document.getElementById("user-number");
  var userMail = document.getElementById("user-email");
  var address = document.querySelector(".address");
  var x = 0;
  console.log(x);
  if (!validateName(userName.value)) {
    toast({
      title: "Error",
      msg: "Vui lòng nhập tên lớn hơn 4 ký tự",
      type: "error",
      duration: 3000,
    });
    ++x;
  }
  console.log(x);
  if (!validatePhone(userPhone.value)) {
    toast({
      title: "Error",
      msg: "Số điện thoại không khả dụng",
      type: "error",
      duration: 3000,
    });
    ++x;
  }
  console.log(x);
  if (!validateMail(userMail.value)) {
    toast({
      title: "Error",
      msg: "Vui lòng đúng định dạng mail",
      type: "error",
      duration: 3000,
    });
    ++x;
  }

  if (x == 0) {
    let checkout = document.querySelector("#cf").value;
    if (checkout) {
      var userInfo = [];
      userInfo.push({
        userName: userName.value,
        userPhone: userPhone.value,
        userMail: userMail.value,
        address: address.value,
      });
      localStorage.setItem("userInfo", JSON.stringify(userInfo));
      window.location = "confrim.html";
      removeAll();
    } else {
      toast({
        title: "Error",
        msg: "Xin đừng để trống câu hỏi",
        type: "error",
        duration: 3000,
      });
    }
  }
}

loadcartNumbers();
